<!DOCTYPE html>
<html>
<head>
  <title>ElectioniaOnline</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Electionia</title>
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootswatch/3.1.0/simplex/bootstrap.min.css">
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->

  <%= stylesheet_link_tag    "application", media: "all" %>
  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tags %>
  <%= include_gon %>
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-48860754-2', 'electionia.com');
      ga('send', 'pageview');

  </script>
</head>
<body>

<div id="fb-root"></div>
<script src="//connect.facebook.net/en_US/all.js"></script>
<script>

    (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s);
        js.id = id;
        js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

    function vote(obj){
        console.log(obj);
//        FB.api(
//                obj.userID+'electionia:vote',
//                'post',
//                {
//                    candidate: "http://samples.ogp.me/419699874799046"
//                },
//                function(response) {
//                    console.log(response);
//                    // handle the response
//                }
//        );

        //FB.api( obj.userID+'/myconnfb:eat', 'post', { meal: "http://samples.ogp.me/420887511378501" }, function(response) { console.log(response)} );


    }

    function login(this_obj,active_tab) {
        $.get('/set_session_var',function(data){
            FB.login(function(response) {

                if (response.authResponse) {
                    //vote(response.authResponse);
                    return window.location = '/users/auth/facebook';
                } else {
                    console.log("error");
                }
            }, {scope: 'publish_actions'});

        });

    }

    function testAPI(resp) {
        FB.api('/me', function(response) {
            console.log('Good to see you, ' + response.name + '.');
        });
    }

//    setTimeout(function() {
//        login();
//    },2000);

</script>
<script>
    if(window.top.location.href != window.location.href){
        window.top.location.href = window.location.href;
    }
</script>





<%= yield %>

</body>
</html>
